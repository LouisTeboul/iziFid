<div>
<style id="izi-style">
    .izi-account {
        min-height: 400px;
    }

    .izi-account input {
        color: #000;
        border: 0;
        border-bottom: 1px solid #ccc;
        -webkit-border-radius: 0;
        -moz-border-radius: 0;
        border-radius: 0;
        width: 100%;
        max-width: 280px;
        height: 34px;
        margin-bottom: 20px;
        font-size: 1.4em;
        -webkit-transition: all .3s ease-in;
        -moz-transition: all .3s ease-in;
        -ms-transition: all .3s ease-in;
        -o-transition: all .3s ease-in;
        transition: all .3s ease-in;
    }

    .izi-account input:focus {
        border-bottom: 1px solid #123456;
        height: 40px;
    }

    .izi-account button {
        -webkit-border-radius: 0;
        -moz-border-radius: 0;
        border-radius: 0;
        background-color: #123456;
        color: #fdfdfd;
        text-transform: uppercase;
        font-weight: 600;
    }

    .izi-account button:hover, .izi-account button:focus {
        color: #fff;
    }

    .izi-account .izi-offers li, .izi-account .izi-balances li {
        color: #fdfdfd;
        padding: 7px 20px;
        margin-bottom: 12px;
        width: 100%;
        background-color: #123456;
        -webkit-box-shadow: 2px 4px 3px #cdcdcd;
        -moz-box-shadow: 2px 4px 3px #cdcdcd;
        box-shadow: 2px 4px 3px #cdcdcd;
    }

    .izi-account .izi-offers li h3, .izi-account .izi-balances li h3, .izi-account li b {
        color: #fdfdfd !important;
        margin-top: 5px;
        margin-bottom: 5px;
    }

    .izi-account .glyphicon {
        color: #123456 !important;
    }

    .izi-account .subtitle {
        color: #333 !important;
    }

    .izi-account .card {
        margin-bottom: 20px;
        padding: 10px;
    }

    .izi-account .md-toast span {
        color: #fdfdfd !important;
    }

    .izi-account .input-group {
        max-width: 75%;
        margin: 10px auto;
    }

    .izi-account md-progress-circular {
        position: absolute;
        top: 50%;
        left: 50%;
    }

    md-dialog {
        width: 60% !important;
    }

    .izi-account [id=balancePaymentInput] {
        padding-top: 13px;
    }
</style>

<div class="izi-account center-block">
<md-progress-circular class="md-warn" md-mode="indeterminate" ng-if="!isReady"></md-progress-circular>
<div ng-if="isReady && barcode && !register">
    <div class="card">
        <i class="glyphicon glyphicon-remove pull-right hvr-grow"
           ng-click="disconnect()" style="font-size: 2em;"></i>

        <h2 class="text-center">{{data.LoyaltyClass}}</h2>

        <div class="row">
            <div class="col-sm-3">
                <div class="barcode-container center-block hidden-xs">
                    <img class="img-responsive center-block barcode-img"
                         data-ng-src="{{clientUrl}}/{{data.Barcodes[0].BarcodeUrl}}"
                         alt=""
                         onerror="$('.barcode-container').slideUp(); $('.onMissingQR').fadeIn('slow')"/>

                    <div class="text-center">
                        <small class="blanc">Carte n° {{barcode}}</small>
                    </div>
                </div>
            </div>

            <div class="col-sm-9">
                <h4 class="no-mg-vert" ng-if="data.CustomerFirstName"><b>Prénom</b>
                    : {{data.CustomerFirstName}}</h4>
                <h4 class="no-mg-vert" ng-if="data.CustomerLastName"><b>Nom</b> : {{data.CustomerLastName}}</h4>
                <h4 class="no-mg-vert" ng-if="data.CustomerEmail"><b>Email</b> :
                    <a data-ng-href="mailto:{{data.CustomerEmail}}">{{data.CustomerEmail}}</a>
                </h4>
            </div>
        </div>
    </div>

    <!-- Offers -->
    <ul class="izi-offers list-unstyled" ng-if="data.Offers.length > 0">
        <li class="bg-accent hvr-sink waves-effect"
            ng-click="showConfirm($event, data.Offers[0])">
            <b class="pull-right">x{{data.Offers.length}}</b>

            <h3 class="text-center no-mg-vert fid-item-title">
                {{data.Offers[0].OfferClassDescription}}
            </h3>

            <div class="text-center">
                <b>{{data.Offers[0].OfferObjectDescription}}</b><br/>
            </div>
        </li>
    </ul>

    <!-- Balances -->
    <ul class="izi-balances list-unstyled">
        <li data-ng-repeat="balance in data.Balances"
            class="{{balance.Value > 0 ? 'bg-accent' : 'bg-rouge'}}">
            <h3 class="text-center no-mg-vert fid-item-title">{{balance.BalanceName}}</h3>

            <div class="text-center">
                <b>Solde: {{balance.Value}} {{balance.BalanceType === 'Dollar' ? '$' :
                    balance.BalanceType}}</b>
            </div>

            <div ng-if="balance.UseToPay">
                <div class="input-group">
                    <input id="balancePaymentInput" class="form-control" ng-minlength="1" ng-pattern="/^[0-9.,]+$/"
                           type="tel"
                           ng-model="balancePayment.value"
                           placeholder="Paiement en avoir..." required>

                    <div class="input-group-addon wave-effect"
                         ng-click="(balancePayment.value && +balancePayment.value > 0) && !hasUsedBalance ? useBalanceToPay(balancePayment.value, balance) : 0"
                            >VALIDER
                    </div>
                </div>
            </div>
        </li>
    </ul>

    <div class="text-center" ng-if="data.CustomerEmail && !data.OneRuleWithOrderAmount">
        <button class="btn btn-lg bg-accent no-radius hvr-sink activated waves-effect" ng-click="addPassage()">
            <i class="icon ion-plus"></i> AJOUTER UN PASSAGE
        </button>
    </div>

    <div class="text-center" ng-if="data.CustomerEmail && data.OneRuleWithOrderAmount">
        <button class="btn btn-lg bg-accent no-radius hvr-sink activated waves-effect" ng-click="orderAmount()">
            <i class="icon ion-plus"></i> MONTANT D'ACHAT
        </button>
    </div>

    <h5 class="text-center light" ng-if="data.CustomerEmail"
        ng-init="bipDate = getDate(data.Barcodes[0].LastBipDate)">
        <small>Dernier passage le: {{bipDate.getDate() + '/' + (bipDate.getMonth() + 1) + '/' +
            bipDate.getFullYear()}}
        </small>
    </h5>
</div>

<!-- LOGIN VIEW -->
<div id="loginView" ng-if="isReady && !barcode && !register" style="margin-top: 30px;">
    <h2 class="title text-center">{{firebase ? customization.title : 'FIDÉLITÉ'}}</h2>
    <h4 class="blanc text-center subtitle">
        {{firebase ? customization.subtitle : 'Veuillez saisir votre numéro de carte ci-dessous'}}
    </h4>

    <form name="iziLoginForm">
        <input type="tel" class="center-block" name="barcodeId" ng-model="form.barcode"
               ng-minlength="8"
               ng-enter="login()"
               ng-pattern="/(^[0-9]*$)|(^[_a-z0-9]+(\.[_a-z0-9]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})$)/"
               placeholder="N° de carte&#8230;"
               ng-change="autoLogin()"
               required/>

        <!--<input class="center-block" type="password" name="password"-->
        <!--ng-model="form.password"-->
        <!--ng-minlength="8"-->
        <!--ng-enter="login()"-->
        <!--placeholder="Mot de passe..." required/>-->
    </form>

    <div class="clearfix">
        <button class="btn btn-lg center-block hvr-grow no-radius {{(iziLoginForm.barcodeId.$invalid || iziLoginForm.barcodeId.$pristine) ? 'bg-rouge' : 'bg-accent'}}"
                ng-disabled="iziLoginForm.barcodeId.$invalid || iziLoginForm.barcodeId.$pristine"
                ng-click="login()">Valider
        </button>
        <br/>
        <!--<a href="" class="blanc cursor-pointer pull-right" ng-click="goRegister()">Enregistrer ma carte</a>-->
    </div>
</div>

<!-- REGISTER VIEW -->
<div id="registerView" ng-if="register">
    <i class="glyphicon glyphicon-remove blanc pull-left hvr-grow"

       ng-click="backToLogin()"></i>

    <div class="container-fluid">
        <h3 class="blanc text-center">Enregistrer Ma Carte<br>
            <small>Tous les champs sont obligatoires</small>
        </h3>


        <form name="registerForm" class="form-horizontal" novalidate>
            <div class="clearfix">
                <label for="barcode" class="col-sm-3">N° de carte</label>

                <div class="form-group col-sm-9">
                    <input id="barcode" name="barcode" class="form-control" type="text" ng-model="client.barcode"
                           placeholder="N° de carte&#8230;" ng-minlength="8" required=""
                           ng-init="client.barcode = registerBarcode"/>

                    <div class="alert alert-danger"
                         ng-if="registerForm.barcode.$invalid && !registerForm.barcode.$pristine">
                        <p class="text-center">Ce numéro de carte n'est pas valide</p>
                    </div>
                </div>
            </div>

            <div class="clearfix">
                <label for="firstname" class="col-sm-3">Prénom</label>

                <div class="form-group col-sm-9">
                    <input id="firstname" name="firstname" class="form-control" type="text" ng-model="client.firstname"
                           placeholder="Prénom&#8230;" ng-minlength="1"
                           ng-pattern="/[a-zA-ZÀ-ÿ ][a-zA-ZÀ-ÿ ][a-zA-ZÀ-ÿ ]+/"
                           required=""/>

                    <div class="alert alert-danger"
                         ng-if="registerForm.firstname.$invalid && !registerForm.firstname.$pristine">
                        <p class="text-center">Ce champ doit comporter au moins 2 caractères</p>
                    </div>
                </div>
            </div>
            <div class="clearfix">
                <label for="lastname" class="col-sm-3">Nom</label>

                <div class="form-group col-sm-9">
                    <input id="lastname" name="lastname" class="form-control" type="text" ng-model="client.lastname"
                           placeholder="Nom&#8230;" ng-minlength="1"
                           ng-pattern="/[a-zA-ZÀ-ÿ ][a-zA-ZÀ-ÿ ][a-zA-ZÀ-ÿ ]+/"
                           required=""/>

                    <div class="alert alert-danger"
                         ng-if="registerForm.lastname.$invalid && !registerForm.lastname.$pristine">
                        <p class="text-center">Ce champ doit comporter au moins 2 caractères</p>
                    </div>
                </div>
            </div>
            <div class="clearfix">
                <label for="email" class="col-sm-3">Email</label>

                <div class="form-group col-sm-9">
                    <input id="email" name="email" class="form-control" type="email" ng-model="client.email"
                           placeholder="Adresse Email&#8230;"
                           ng-pattern="/^[_a-z0-9]+(\.[_a-z0-9]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})$/"
                           required=""/>

                    <div class="alert alert-danger"
                         ng-if="registerForm.email.$invalid && !registerForm.email.$pristine">
                        <p class="text-center">Cette adresse email ne semble pas être valide</p>
                    </div>
                </div>
            </div>
            <div class="clearfix">
                <label for="tel" class="col-sm-3">Tél.</label>

                <div class="form-group col-sm-9">
                    <input id="tel" name="tel" class="form-control" type="tel" ng-model="client.tel"
                           placeholder="N° de téléphone&#8230;"
                           ng-minlength="6"
                           required=""/>

                    <div class="alert alert-danger" ng-if="registerForm.tel.$invalid && !registerForm.tel.$pristine">
                        <p class="text-center">Ce numéro de téléphone ne semble pas être valide</p>
                    </div>
                </div>
            </div>
            <div class="clearfix">
                <label for="email" class="col-sm-3">Adresse</label>

                <div class="form-group col-sm-9">
                    <input id="address" name="address" class="form-control" type="text" ng-model="client.address"
                           placeholder="Adresse&#8230;" ng-minlength="8" required=""/>

                    <div class="alert alert-danger"
                         ng-if="registerForm.address.$invalid && !registerForm.address.$pristine">
                        <p class="text-center">Ce champ doit comporter au moins 8 caractères</p>
                    </div>
                </div>
            </div>
            <div class="clearfix">
                <label for="zipcode" class="col-sm-3">Code Postal</label>

                <div class="form-group col-sm-9">
                    <input id="zipcode" name="zipcode" class="form-control" type="tel" ng-model="client.zipcode"
                           placeholder="Code Postal&#8230;" ng-minlength="6"
                           required=""/>

                    <div class="alert alert-danger"
                         ng-if="registerForm.zipcode.$invalid && !registerForm.zipcode.$pristine">
                        <p class="text-center">Ce champ doit comporter au moins 6 caractères</p>
                    </div>
                </div>
            </div>
            <div class="clearfix">
                <label for="email" class="col-sm-3">Ville</label>

                <div class="form-group col-sm-9">
                    <input id="city" name="city" class="form-control" type="text" ng-model="client.city"
                           placeholder="Ville&#8230;"
                           ng-minlength="2"
                           required=""/>

                    <div class="alert alert-danger" ng-if="registerForm.city.$invalid && !registerForm.city.$pristine">
                        <p class="text-center">Ce champ doit comporter au moins 2 caractères</p>
                    </div>
                </div>
            </div>
            <div class="clearfix">
                <label for="password" class="col-sm-3">Mot de Passe</label>

                <div class="form-group col-sm-9">
                    <input id="password" name="password" class="form-control" type="password" ng-model="client.password"
                           placeholder="Mot de passe&#8230;" ng-minlength="8" required=""/>

                    <div class="alert alert-danger"
                         ng-if="registerForm.password.$invalid && !registerForm.password.$pristine">
                        <p class="text-center">Votre mot de passe doit comporter au moins 8 caractères</p>
                    </div>
                </div>
            </div>
            <div class="clearfix">
                <label for="password" class="col-sm-3">Mot de Passe (confirmation)</label>

                <div class="form-group col-sm-9">
                    <input id="passwordConfirm" name="passwordConfirm" class="form-control" type="password"
                           ng-model="client.passwordConfirm"
                           placeholder="Mot de passe (confirmation)&#8230;"
                           compare-to="client.password"
                           ng-minlength="8"
                           required=""/>

                    <div class="alert alert-danger"
                         ng-if="client.password !== client.passwordConfirm && !registerForm.passwordConfirm.$pristine">
                        <p class="text-center">Le mot de passe ne correspond pas</p>
                    </div>
                </div>
            </div>
            <div class="text-center">
                <button id="submitRegister"
                        class="btn bg-{{registerForm.$invalid ? 'rouge' : 'accent'}} btn-lg center-block text-center no-radius"
                        ng-disabled="registerForm.$invalid || registerForm.$pristine"
                        ng-click="submitRegister()">VALIDER
                </button>
            </div>
        </form>
    </div>
</div>
</div>
</div>
