/*! izi-api (Build date: 19-05-2015) */
'use strict';angular.module('APIServiceApp',[]).factory('APIService',['$http','$log','$timeout',function(a,b,c){var d,e,f,g,h,i;return e={endpoint:"/api/RESTLoyalty/RESTLoyalty/",clientUrl:"",fake:!1,debug:!0,currLoyaltyObject:{},validClientUrls:["http://pitapit.fr","http://urbun.fr","http://beautyburger.com","http://madamecroque.fr","http://planetalis.com","http://cooking.bigsister.biz"]},f={missingClientUrl:function(){return e.debug?b.error("Client URL is not set! Use APIService.set.clientUrl(xxx)"):0},invalidBarcode:function(a){return e.debug?b.error("Barcode is not valid:",a):0},notLoggedIn:function(){return e.debug?b.error("No client logged in"):0},addPassage:function(){return e.debug?b.error("AddPassage ERROR, API returned false."):0}},d={set:{clientUrl:function(a){e.clientUrl=a},endpoint:function(a){e.endpoint=a},debug:function(a){e.debug=!!a},fake:function(a){e.fake=!!a}},get:{callableUrl:function(a){return d.validate.clientUrl()?e.clientUrl+e.endpoint+a:f.missingClientUrl()},emptyData:function(){return h},loyaltyObject:function(b,h){return c(function(){var c=d.validate.barcode(b),i=d.validate.clientUrl();return c&&i?e.fake?(e.currLoyaltyObject=g,h(g)):void a.get(d.get.callableUrl("GetloyaltyObject?barcode="+b)).success(function(a){return e.currLoyaltyObject=a,h(a)}):c?f.missingClientUrl():f.invalidBarcode(b)},0)},formattedOffers:function(a){for(var b=a.Offers,c=[],d=[],e=0;e<b.length;e++){var f=e+1;if(f>=b.length&&(f=e-1),b[e].isValid)if(0===e||b[e].OfferTypeId!==b[f].OfferTypeId)c.indexOf(b[e].OfferTypeId)>-1?d[c.indexOf(b[e].OfferTypeId)].counter++:(c.push(b[e].OfferTypeId),d.push(b[e]),d[d.length-1].counter=1);else{var g=d.length-1;0>g?g=0:0,d[g]?d[g].counter++:0}}return d},emptyPassageObj:function(){return{Login:null,Password:null,Key:null,Barcode:e.currLoyaltyObject.Barcodes[0].Barcode,CustomerFirstName:e.currLoyaltyObject.CustomerFirstName,CustomerLastName:e.currLoyaltyObject.CustomerLastName,CustomerEmail:e.currLoyaltyObject.CustomerEmail,OrderTotalIncludeTaxes:0,OrderTotalExcludeTaxes:0,CurrencyCode:"EUR",Items:[],BalanceUpdate:{},OrderSpecificInfo:"2"}}},actions:{useOffer:function(a,b){if(d.validate.barcode(b)){var c=d.get.emptyPassageObj();return c.Offer={OfferObjectId:a,Barcode:b,Date:new Date},d.actions.addPassage(c)}return!1},useAvoir:function(a,b){var c=d.get.emptyPassageObj();c.BalanceUpdate={Id:a,UpdateValue:b}},addPassage:function(b){return $.isEmptyObject(b)?!1:i?void(i=null):i=a.post(d.get.callableUrl("AddPassage"),JSON.stringify(JSON.stringify(b))).success(function(a){return a})},register:function(b){return c(function(){return e.fake?g:a.post(d.get.callableUrl("Register"),JSON.stringify(JSON.stringify(b))).success(function(a){return e.currLoyaltyObject=a,a})},0)}},validate:{clientUrl:function(){return!!~e.validClientUrls.indexOf(e.clientUrl)},barcode:function(a){return!(!+a||!~[8,10].indexOf(a.toString().length))}}},h={Barcodes:[],LoyaltyObjectId:0,CustomerId:0,LoyaltyClass:null,CustomerFirstName:null,CustomerLastName:null,CustomerEmail:null,Balances:[],Offers:[]},g={Barcodes:[{Barcode:"0004405498",BarcodeUrl:"/Barcode/77u_UXJCYXJjb2RlWzAsMCw1LDNdOjAwMDQ0MDU0OTg6LTk3MTEwMTEyNw2",BarcodeType:"QrCode",CreationDate:"2015-04-22T14:34:51.927",LastUseDate:null,LastBipDate:"2015-05-04T11:16:47.583"}],LoyaltyObjectId:2890,LoyaltyPictureUrl:null,CustomerId:1300915,LoyaltyClass:"Carte Cooking",CustomerFirstName:"Stephen",CustomerLastName:"TISSOT",CustomerEmail:"toto01@toto.com",Balances:[{Id:2890,BalanceName:"Cagnotte Cooking",BalanceType:"Euros",BalanceType_Id:3,Value:25.97,ValidForTenant:"COOKING MAISON",UseToPay:!0,MinOrderTotalIncVAT:0,MinOrderTotalWitoutLoyalty:0}],Offers:[{OfferObjectId:22058,Barcode:"0741110815",OfferObjectDescription:"Coca offert",OfferClassDescription:"Coca offert",OfferImageUrl:"http://montpellier.bigsister.biz/Media/Thumbs/0003/0003139.jpg",OfferTypeId:2,OfferTypeName:"AddProduct",isValid:!1,OfferParam:"{\"ProductId\":[\"1660-COCA.COLA ZERO\"],\"Price\":0,\"MinOrderIncTax\":0}"},{OfferObjectId:22059,Barcode:"0901429129",OfferObjectDescription:"Coca offert",OfferClassDescription:"Coca offert",OfferImageUrl:"http://montpellier.bigsister.biz/Media/Thumbs/0003/0003139.jpg",OfferTypeId:2,OfferTypeName:"AddProduct",isValid:!1,OfferParam:"{\"ProductId\":[\"1660-COCA.COLA ZERO\"],\"Price\":0,\"MinOrderIncTax\":0}"},{OfferObjectId:22061,Barcode:"0399778143",OfferObjectDescription:"Coca offert",OfferClassDescription:"Coca offert",OfferImageUrl:"http://montpellier.bigsister.biz/Media/Thumbs/0003/0003139.jpg",OfferTypeId:2,OfferTypeName:"AddProduct",isValid:!1,OfferParam:"{\"ProductId\":[\"1660-COCA.COLA ZERO\"],\"Price\":0,\"MinOrderIncTax\":0}"},{OfferObjectId:22062,Barcode:"0594962883",OfferObjectDescription:"Coca offert",OfferClassDescription:"Coca offert",OfferImageUrl:"http://montpellier.bigsister.biz/Media/Thumbs/0003/0003139.jpg",OfferTypeId:2,OfferTypeName:"AddProduct",isValid:!0,OfferParam:"{\"ProductId\":[\"1660-COCA.COLA ZERO\"],\"Price\":0,\"MinOrderIncTax\":0}"},{OfferObjectId:22063,Barcode:"0452116923",OfferObjectDescription:"Coca offert",OfferClassDescription:"Coca offert",OfferImageUrl:"http://montpellier.bigsister.biz/Media/Thumbs/0003/0003139.jpg",OfferTypeId:2,OfferTypeName:"AddProduct",isValid:!0,OfferParam:"{\"ProductId\":[\"1660-COCA.COLA ZERO\"],\"Price\":0,\"MinOrderIncTax\":0}"},{OfferObjectId:22064,Barcode:"0006106690",OfferObjectDescription:"Coca offert",OfferClassDescription:"Coca offert",OfferImageUrl:"http://montpellier.bigsister.biz/Media/Thumbs/0003/0003139.jpg",OfferTypeId:2,OfferTypeName:"AddProduct",isValid:!0,OfferParam:"{\"ProductId\":[\"1660-COCA.COLA ZERO\"],\"Price\":0,\"MinOrderIncTax\":0}"},{OfferObjectId:22065,Barcode:"0222065758",OfferObjectDescription:"Coca offert",OfferClassDescription:"Coca offert",OfferImageUrl:"http://montpellier.bigsister.biz/Media/Thumbs/0003/0003139.jpg",OfferTypeId:2,OfferTypeName:"AddProduct",isValid:!0,OfferParam:"{\"ProductId\":[\"1660-COCA.COLA ZERO\"],\"Price\":0,\"MinOrderIncTax\":0}"},{OfferObjectId:22066,Barcode:"0058445470",OfferObjectDescription:"Coca offert",OfferClassDescription:"Coca offert",OfferImageUrl:"http://montpellier.bigsister.biz/Media/Thumbs/0003/0003139.jpg",OfferTypeId:2,OfferTypeName:"AddProduct",isValid:!0,OfferParam:"{\"ProductId\":[\"1660-COCA.COLA ZERO\"],\"Price\":0,\"MinOrderIncTax\":0}"},{OfferObjectId:22067,Barcode:"0274404538",OfferObjectDescription:"Coca offert",OfferClassDescription:"Coca offert",OfferImageUrl:"http://montpellier.bigsister.biz/Media/Thumbs/0003/0003139.jpg",OfferTypeId:2,OfferTypeName:"AddProduct",isValid:!0,OfferParam:"{\"ProductId\":[\"1660-COCA.COLA ZERO\"],\"Price\":0,\"MinOrderIncTax\":0}"},{OfferObjectId:22068,Barcode:"0469589278",OfferObjectDescription:"Coca offert",OfferClassDescription:"Coca offert",OfferImageUrl:"http://montpellier.bigsister.biz/Media/Thumbs/0003/0003139.jpg",OfferTypeId:2,OfferTypeName:"AddProduct",isValid:!0,OfferParam:"{\"ProductId\":[\"1660-COCA.COLA ZERO\"],\"Price\":0,\"MinOrderIncTax\":0}"},{OfferObjectId:22069,Barcode:"0862371496",OfferObjectDescription:"Dessert offert",OfferClassDescription:"Dessert offert",OfferImageUrl:"http://montpellier.bigsister.biz/Media/Thumbs/0003/0003140.jpg",OfferTypeId:4,OfferTypeName:"OneProductInCategory",isValid:!0,OfferParam:"{\"CategoryId\":[\"67-DESSERTS\"],\"Price\":0,\"MinOrderIncTax\":0}"},{OfferObjectId:22071,Barcode:"0555905249",OfferObjectDescription:"Dessert offert",OfferClassDescription:"Dessert offert",OfferImageUrl:"http://montpellier.bigsister.biz/Media/Thumbs/0003/0003140.jpg",OfferTypeId:4,OfferTypeName:"OneProductInCategory",isValid:!0,OfferParam:"{\"CategoryId\":[\"67-DESSERTS\"],\"Price\":0,\"MinOrderIncTax\":0}"},{OfferObjectId:22072,Barcode:"0751089989",OfferObjectDescription:"Dessert offert",OfferClassDescription:"Dessert offert",OfferImageUrl:"http://montpellier.bigsister.biz/Media/Thumbs/0003/0003140.jpg",OfferTypeId:4,OfferTypeName:"OneProductInCategory",isValid:!0,OfferParam:"{\"CategoryId\":[\"67-DESSERTS\"],\"Price\":0,\"MinOrderIncTax\":0}"},{OfferObjectId:22073,Barcode:"0608244030",OfferObjectDescription:"Dessert offert",OfferClassDescription:"Dessert offert",OfferImageUrl:"http://montpellier.bigsister.biz/Media/Thumbs/0003/0003140.jpg",OfferTypeId:4,OfferTypeName:"OneProductInCategory",isValid:!0,OfferParam:"{\"CategoryId\":[\"67-DESSERTS\"],\"Price\":0,\"MinOrderIncTax\":0}"},{OfferObjectId:22074,Barcode:"0325854084",OfferObjectDescription:"Dessert offert",OfferClassDescription:"Dessert offert",OfferImageUrl:"http://montpellier.bigsister.biz/Media/Thumbs/0003/0003140.jpg",OfferTypeId:4,OfferTypeName:"OneProductInCategory",isValid:!0,OfferParam:"{\"CategoryId\":[\"67-DESSERTS\"],\"Price\":0,\"MinOrderIncTax\":0}"},{OfferObjectId:22075,Barcode:"0001987708",OfferObjectDescription:"Coca offert",OfferClassDescription:"Coca offert",OfferImageUrl:"http://montpellier.bigsister.biz/Media/Thumbs/0003/0003139.jpg",OfferTypeId:2,OfferTypeName:"AddProduct",isValid:!0,OfferParam:"{\"ProductId\":[\"1660-COCA.COLA ZERO\"],\"Price\":0,\"MinOrderIncTax\":0}"},{OfferObjectId:22076,Barcode:"0375616471",OfferObjectDescription:"Coca offert",OfferClassDescription:"Coca offert",OfferImageUrl:"http://montpellier.bigsister.biz/Media/Thumbs/0003/0003139.jpg",OfferTypeId:2,OfferTypeName:"AddProduct",isValid:!0,OfferParam:"{\"ProductId\":[\"1660-COCA.COLA ZERO\"],\"Price\":0,\"MinOrderIncTax\":0}"},{OfferObjectId:22077,Barcode:"0873348243",OfferObjectDescription:"Coca offert",OfferClassDescription:"Coca offert",OfferImageUrl:"http://montpellier.bigsister.biz/Media/Thumbs/0003/0003139.jpg",OfferTypeId:2,OfferTypeName:"AddProduct",isValid:!0,OfferParam:"{\"ProductId\":[\"1660-COCA.COLA ZERO\"],\"Price\":0,\"MinOrderIncTax\":0}"},{OfferObjectId:22078,Barcode:"0327293246",OfferObjectDescription:"Coca offert",OfferClassDescription:"Coca offert",OfferImageUrl:"http://montpellier.bigsister.biz/Media/Thumbs/0003/0003139.jpg",OfferTypeId:2,OfferTypeName:"AddProduct",isValid:!0,OfferParam:"{\"ProductId\":[\"1660-COCA.COLA ZERO\"],\"Price\":0,\"MinOrderIncTax\":0}"},{OfferObjectId:22079,Barcode:"0272771550",OfferObjectDescription:"Coca offert",OfferClassDescription:"Coca offert",OfferImageUrl:"http://montpellier.bigsister.biz/Media/Thumbs/0003/0003139.jpg",OfferTypeId:2,OfferTypeName:"AddProduct",isValid:!0,OfferParam:"{\"ProductId\":[\"1660-COCA.COLA ZERO\"],\"Price\":0,\"MinOrderIncTax\":0}"},{OfferObjectId:22080,Barcode:"0165293831",OfferObjectDescription:"Coca offert",OfferClassDescription:"Coca offert",OfferImageUrl:"http://montpellier.bigsister.biz/Media/Thumbs/0003/0003139.jpg",OfferTypeId:2,OfferTypeName:"AddProduct",isValid:!0,OfferParam:"{\"ProductId\":[\"1660-COCA.COLA ZERO\"],\"Price\":0,\"MinOrderIncTax\":0}"},{OfferObjectId:22081,Barcode:"0890548605",OfferObjectDescription:"Coca offert",OfferClassDescription:"Coca offert",OfferImageUrl:"http://montpellier.bigsister.biz/Media/Thumbs/0003/0003139.jpg",OfferTypeId:2,OfferTypeName:"AddProduct",isValid:!0,OfferParam:"{\"ProductId\":[\"1660-COCA.COLA ZERO\"],\"Price\":0,\"MinOrderIncTax\":0}"},{OfferObjectId:22082,Barcode:"0298220727",OfferObjectDescription:"Coca offert",OfferClassDescription:"Coca offert",OfferImageUrl:"http://montpellier.bigsister.biz/Media/Thumbs/0003/0003139.jpg",OfferTypeId:2,OfferTypeName:"AddProduct",isValid:!0,OfferParam:"{\"ProductId\":[\"1660-COCA.COLA ZERO\"],\"Price\":0,\"MinOrderIncTax\":0}"},{OfferObjectId:22083,Barcode:"0904549275",OfferObjectDescription:"Coca offert",OfferClassDescription:"Coca offert",OfferImageUrl:"http://montpellier.bigsister.biz/Media/Thumbs/0003/0003139.jpg",OfferTypeId:2,OfferTypeName:"AddProduct",isValid:!0,OfferParam:"{\"ProductId\":[\"1660-COCA.COLA ZERO\"],\"Price\":0,\"MinOrderIncTax\":0}"},{OfferObjectId:22084,Barcode:"0510877822",OfferObjectDescription:"Coca offert",OfferClassDescription:"Coca offert",OfferImageUrl:"http://montpellier.bigsister.biz/Media/Thumbs/0003/0003139.jpg",OfferTypeId:2,OfferTypeName:"AddProduct",isValid:!0,OfferParam:"{\"ProductId\":[\"1660-COCA.COLA ZERO\"],\"Price\":0,\"MinOrderIncTax\":0}"},{OfferObjectId:22085,Barcode:"0117206369",OfferObjectDescription:"Coca offert",OfferClassDescription:"Coca offert",OfferImageUrl:"http://montpellier.bigsister.biz/Media/Thumbs/0003/0003139.jpg",OfferTypeId:2,OfferTypeName:"AddProduct",isValid:!0,OfferParam:"{\"ProductId\":[\"1660-COCA.COLA ZERO\"],\"Price\":0,\"MinOrderIncTax\":0}"},{OfferObjectId:22086,Barcode:"0723534916",OfferObjectDescription:"Coca offert",OfferClassDescription:"Coca offert",OfferImageUrl:"http://montpellier.bigsister.biz/Media/Thumbs/0003/0003139.jpg",OfferTypeId:2,OfferTypeName:"AddProduct",isValid:!0,OfferParam:"{\"ProductId\":[\"1660-COCA.COLA ZERO\"],\"Price\":0,\"MinOrderIncTax\":0}"},{OfferObjectId:22087,Barcode:"0329863464",OfferObjectDescription:"Coca offert",OfferClassDescription:"Coca offert",OfferImageUrl:"http://montpellier.bigsister.biz/Media/Thumbs/0003/0003139.jpg",OfferTypeId:2,OfferTypeName:"AddProduct",isValid:!0,OfferParam:"{\"ProductId\":[\"1660-COCA.COLA ZERO\"],\"Price\":0,\"MinOrderIncTax\":0}"},{OfferObjectId:22088,Barcode:"0294997038",OfferObjectDescription:"Coca offert",OfferClassDescription:"Coca offert",OfferImageUrl:"http://montpellier.bigsister.biz/Media/Thumbs/0003/0003139.jpg",OfferTypeId:2,OfferTypeName:"AddProduct",isValid:!0,OfferParam:"{\"ProductId\":[\"1660-COCA.COLA ZERO\"],\"Price\":0,\"MinOrderIncTax\":0}"},{OfferObjectId:22089,Barcode:"0804926779",OfferObjectDescription:"Dessert offert",OfferClassDescription:"Dessert offert",OfferImageUrl:"http://montpellier.bigsister.biz/Media/Thumbs/0003/0003140.jpg",OfferTypeId:4,OfferTypeName:"OneProductInCategory",isValid:!1,OfferParam:"{\"CategoryId\":[\"67-DESSERTS\"],\"Price\":0,\"MinOrderIncTax\":0}"},{OfferObjectId:22101,Barcode:"0641824893",OfferObjectDescription:"Vous avez gagné un bisou !",OfferClassDescription:"Un bisou",OfferImageUrl:"http://cooking.bigsister.biz/Media/Thumbs/0003/0003141.jpg",OfferTypeId:1,OfferTypeName:"PromoText",isValid:!0,OfferParam:"{\"Value\":\"Vous avez gagné un bisou !\"}"}],History:[{date:"2015-05-04T11:16:28.65",Description:"Vous avez gagné un bisou !",BalanceName:null,Value:1},{date:"2015-05-04T09:16:28.503",Description:"Créditer la carte",BalanceName:null,Value:2.07},{date:"2015-04-22T19:59:20.67",Description:"Ticket 11896 use offer Carte Cooking",BalanceName:null,Value:0},{date:"2015-04-22T19:55:48.763",Description:"Ticket 11895 use offer Carte Cooking",BalanceName:null,Value:0},{date:"2015-04-22T19:55:48.457",Description:"Dessert offert",BalanceName:null,Value:1},{date:"2015-04-22T19:51:34.18",Description:"Ticket 11894 use offer Carte Cooking",BalanceName:null,Value:0},{date:"2015-04-22T19:51:33.947",Description:"Ticket 11894 use offer Carte Cooking",BalanceName:null,Value:0},{date:"2015-04-22T19:42:22.617",Description:"Ticket 11893 use offer Carte Cooking",BalanceName:null,Value:0},{date:"2015-04-22T19:42:17.6",Description:"Ticket 11893 use offer Carte Cooking",BalanceName:null,Value:0},{date:"2015-04-22T19:18:08.017",Description:"Coca offert",BalanceName:null,Value:1},{date:"2015-04-22T19:18:07.763",Description:"Coca offert",BalanceName:null,Value:1},{date:"2015-04-22T19:18:07.513",Description:"Coca offert",BalanceName:null,Value:1},{date:"2015-04-22T19:18:07.263",Description:"Coca offert",BalanceName:null,Value:1},{date:"2015-04-22T19:18:07.013",Description:"Coca offert",BalanceName:null,Value:1},{date:"2015-04-22T19:18:06.763",Description:"Coca offert",BalanceName:null,Value:1},{date:"2015-04-22T19:18:06.513",Description:"Coca offert",BalanceName:null,Value:1},{date:"2015-04-22T19:04:18.277",Description:"Coca offert",BalanceName:null,Value:1},{date:"2015-04-22T19:04:15.637",Description:"Coca offert",BalanceName:null,Value:1},{date:"2015-04-22T19:03:42.467",Description:"Coca offert",BalanceName:null,Value:1},{date:"2015-04-22T19:03:37.913",Description:"Coca offert",BalanceName:null,Value:1}]},d}]);