/*! izi-api (Build date: 07-05-2015) */
"use strict";angular.module('iziWebQr').directive('iziAccount',function(){return{restrict:"EA",replace:!0,transclude:!0,scope:{barcode:"@",clientUrl:"@",theme:"@",otherModelValue:"=compareTo"},template:'<div><style id="izi-style">@import url(http://fonts.googleapis.com/css?family=Raleway:300,600,500,400,100,800,200,700);.izi-account{box-shadow:2px 3px 18px #555;background-color:#343434;color:#fdfdfd!important;font-family:Raleway,Helvetica,sans-serif;font-weight:400!important;max-width:600px;transition:all .3s ease-out}.izi-account,.izi-account form input{-ms-transition:all .3s ease-out;-o-transition:all .3s ease-out;-webkit-transition:all .3s ease-out;-moz-transition:all .3s ease-out}.cursor-pointer{cursor:pointer}.izi-account a:hover{color:#fff}.izi-account small{color:#fdfdfd}.izi-account h3,.izi-account h4{font-weight:500!important}.izi-account .bg-rouge{background-color:#e74c3c;cursor:not-allowed}.izi-account .bg-vert{background-color:#16a085}.izi-account .green-sea{color:#16a085!important}.izi-account .barcode-container{background:#16a085;padding:40px;width:216px;height:216px;border-radius:100%;-webkit-animation:rotateScale .6s ease-out;animation:rotate .6s ease-out}@-webkit-keyframes rotateScale{from{-webkit-transform:rotate(0);zoom:.1}to{-webkit-transform:rotate(360deg);zoom:1}}@keyframes rotateScale{from{-moz-transform:rotate(0);transform:rotate(0);zoom:.1}to{-moz-transform:rotate(360deg);transform:rotate(360deg);zoom:1}}.izi-account .hvr-sink{cursor:pointer;vertical-align:middle;-webkit-transform:translateZ(0);transform:translateZ(0);box-shadow:0 0 1px transparent;-webkit-backface-visibility:hidden;backface-visibility:hidden;-moz-osx-font-smoothing:grayscale;-webkit-transition-duration:.3s;transition-duration:.3s;-webkit-transition-property:transform;transition-property:transform;-webkit-transition-timing-function:ease-out;transition-timing-function:ease-out}.hvr-sink:focus,.hvr-sink:hover,.izi-account .hvr-sink:active{-webkit-transform:translateY(8px);transform:translateY(8px)}.izi-account input.ng-invalid:not(.ng-pristine){border-color:#e74c3c!important}.izi-account input.ng-valid:not(.ng-pristine):not(.ng-dirty){border-color:#16a085}.izi-account form input{width:75%;padding-left:2px;height:35px;margin-top:15px;margin-bottom:15px;font-size:1.5em;transition:all .3s ease-out}.izi-account form input:focus{height:45px!important;outline:0}.izi-offers{margin-top:20px}.izi-offers li.bg-rouge{background-size:cover!important;box-shadow:inset 0 0 0 1000px rgba(231,76,60,.8)}.izi-offers li.bg-vert{background-size:cover;box-shadow:inset 0 0 0 1000px rgba(22,160,133,.8)}.izi-balances li,.izi-offers li{color:#fdfdfd;padding:7px}.izi-offers h4{color:#fdfdfd}.izi-balances .text-center b,.izi-offers .text-center b{font-size:1.2em}.izi-account .no-mg-vert{margin-top:0;margin-bottom:0}.izi-account .light{font-weight:200!important}.izi-account .no-radius{-webkit-border-radius:0;-moz-border-radius:0;border-radius:0}.izi-account [name=registerForm] label{padding-top:8px;text-align:right;padding-left:0;margin-left:0}.izi-account [name=registerForm] input{font-size:1.2em;margin:0;width:98%}.izi-account [name=registerForm] input.ng-invalid-required,.izi-account [name=registerForm] input.ng-pristine:focus{border-color:#ccc!important}.izi-account [name=registerForm] input.ng-valid:not(.ng-pristine):focus,[name=barcodeId].ng-valid:not(.ng-pristine):focus{border-color:#2ebd65!important}.izi-account [id=registerView]{padding-bottom:20px}.izi-account [name=barcodeId],[name=barcodeId]:focus{border:1px solid;-webkit-border-radius:4px;-moz-border-radius:4px;border-radius:4px}.izi-account.izi-light-theme{background-color:#fdfdfd!important;color:#343434!important;box-shadow:none!important}.izi-account.izi-light-theme,.izi-light-theme input:focus{-webkit-box-shadow:none!important;-moz-box-shadow:none!important}.izi-light-theme .glyphicon,.izi-light-theme a,.izi-light-theme a:hover,.izi-light-theme h1,.izi-light-theme h2,.izi-light-theme h3,.izi-light-theme h4,.izi-light-theme small{color:#343434!important}.izi-light-theme input:focus{box-shadow:none!important}.izi-account [id=submitRegister]{margin-top:12px}</style><div class="izi-account center-block"><div style="padding: 15px 15px 10px" ng-if="barcode && !register"><i class="glyphicon glyphicon-remove blanc pull-right hvr-grow" style="cursor: pointer; font-size: 2.1em" ng-click="disconnect()"></i><div class="barcode-container center-block"><img class="img-responsive center-block barcode-img" data-ng-src="http://izico.de/{{barcode}}.png?s=5" alt="" onerror="$(\'.barcode-container\').slideUp(); $(\'.onMissingQR\').fadeIn(\'slow\')"><h4 class="text-center" style="margin-top: 0"><small>Carte n° {{barcode}}</small></h4></div><h4 class="text-center onMissingQR" style="margin-top: 0; display: none"><small>Carte n° {{barcode}}</small></h4><h1 class="text-center text-uppercase green-sea light">{{data.LoyaltyClass}}</h1><h4 class="text-center" ng-if="data.CustomerFirstName">Prénom : {{data.CustomerFirstName}}</h4><h4 class="text-center" ng-if="data.CustomerLastName">Nom : {{data.CustomerLastName}}</h4><h4 class="text-center" ng-if="data.CustomerEmail">Email : <a class="green-sea" data-ng-href="mailto:{{data.CustomerEmail}}">{{data.CustomerEmail}}</a></h4><h3 class="text-center" ng-if="!data.CustomerFirstName && !data.CustomerLastName && !data.CustomerEmail">CARTE VIDE !</h3><!-- Offers --><ul class="izi-offers list-unstyled"><li data-ng-repeat="offer in data.Offers" class="{{offer.isValid ? \'bg-vert hvr-sink\' : \'bg-rouge\'}}" ng-click="useOffer(offer)" style="background: url({{offer.OfferImageUrl}}) no-repeat center -35px; margin-bottom: 15px"><b class="pull-right">x{{offer.counter}}</b><h4 class="text-center no-mg-vert">{{offer.OfferClassDescription}}</h4><div class="text-center"><b>{{offer.OfferObjectDescription}}</b><br></div></li></ul><!-- Balances --><ul class="izi-balances list-unstyled"><li data-ng-repeat="balance in data.Balances" class="{{balance.Value > 0 ? \'bg-vert hvr-sink\' : \'bg-rouge\'}}"><h4 class="text-center no-mg-vert">{{balance.BalanceName}}</h4><div class="text-center"><b>Solde: {{balance.Value}} {{balance.BalanceType === \'Euros\' ? \'€\' : balance.BalanceType}}</b></div></li></ul><h5 class="text-center light" ng-if="data.CustomerEmail" ng-init="bipDate = getDate(data.Barcodes[0].LastBipDate)" style="margin-bottom: 0"><small style="color: #777">Dernier passage le: {{bipDate.getDate() + \'/\' + bipDate.getMonth() + \'/\' + bipDate.getFullYear()}}</small></h5></div><!-- LOGIN VIEW --><div ng-if="!barcode && !register" style="padding: 15px 15px 5px"><h4 class="blanc text-center">Veuillez saisir votre n° de carte pour accéder à votre compte</h4><form name="iziLoginForm"><input type="tel" name="barcodeId" class="center-block noir" ng-model="form.barcode" placeholder="N° de carte..." ng-minlength="8" maxlength="10" ng-enter="login()" ng-pattern="/^[0-9]*$/" style=""></form><button class="btn btn-default btn-lg center-block bg-blanc noir hvr-grow no-radius" ng-disabled="iziLoginForm.barcodeId.$invalid || iziLoginForm.barcodeId.$pristine" ng-click="login()">Valider</button> <a href="" class="blanc cursor-pointer pull-right" ng-click="goRegister()">S\'enregistrer</a><br></div><!-- REGISTER VIEW --><div id="registerView" ng-if="register"><i class="glyphicon glyphicon-remove blanc pull-right hvr-grow" style="cursor: pointer; margin-top: 12px;margin-right: 12px" ng-click="backToLogin()"></i><div class="container-fluid"><h3 class="blanc text-center">Enregistrer Ma Carte</h3><br><form name="registerForm" class="form-horizontal" novalidate><div class="clearfix"><label for="barcode" class="col-sm-3">N° de carte</label><div class="form-group col-sm-9"><input id="barcode" class="form-control" type="text" ng-model="client.barcode" placeholder="N° de carte&#8230;" ng-minlength="8" required=""></div></div><div class="clearfix"><label for="firstname" class="col-sm-3">Prénom</label><div class="form-group col-sm-9"><input id="firstname" class="form-control" type="text" ng-model="client.firstname" placeholder="Prénom&#8230;" ng-minlength="2" ng-pattern="/[a-zA-ZÀ-ÿ ][a-zA-ZÀ-ÿ ][a-zA-ZÀ-ÿ ]+/" required=""></div></div><div class="clearfix"><label for="lastname" class="col-sm-3">Nom</label><div class="form-group col-sm-9"><input id="lastname" class="form-control" type="text" ng-model="client.lastname" placeholder="Nom&#8230;" ng-minlength="2" ng-pattern="/[a-zA-ZÀ-ÿ ][a-zA-ZÀ-ÿ ][a-zA-ZÀ-ÿ ]+/" required=""></div></div><div class="clearfix"><label for="email" class="col-sm-3">Email</label><div class="form-group col-sm-9"><input id="email" class="form-control" type="email" ng-model="client.email" placeholder="Adresse Email&#8230;" ng-pattern="/^[_a-z0-9]+(.[_a-z0-9]+)*@[a-z0-9-]+(.[a-z0-9-]+)*(.[a-z]{2,4})$/" required=""></div></div><div class="clearfix"><label for="tel" class="col-sm-3">Tél.</label><div class="form-group col-sm-9"><input id="tel" class="form-control" type="tel" ng-model="client.tel" placeholder="N° de téléphone&#8230;" ng-pattern="/^[0-9]+$/" required=""></div></div><div class="clearfix"><label for="email" class="col-sm-3">Adresse</label><div class="form-group col-sm-9"><input id="address" class="form-control" type="text" ng-model="client.address" placeholder="Adresse&#8230;" required=""></div></div><div class="clearfix"><label for="zipcode" class="col-sm-3">Code Postal</label><div class="form-group col-sm-9"><input id="zipcode" class="form-control" type="tel" ng-model="client.zipcode" placeholder="Code Postal&#8230;" ng-minlength="5" maxlength="5" ng-pattern="/^(d)+$/" required=""></div></div><div class="clearfix"><label for="email" class="col-sm-3">Ville</label><div class="form-group col-sm-9"><input id="city" class="form-control" type="text" ng-model="client.city" placeholder="Ville&#8230;" ng-minlength="2" required=""></div></div><div class="clearfix"><label for="password" class="col-sm-3">Mot de Passe</label><div class="form-group col-sm-9"><input id="password" class="form-control" type="password" ng-model="client.password" placeholder="Mot de passe&#8230;" ng-minlength="8" required=""></div></div><div class="clearfix"><label for="password" class="col-sm-3" style="padding-top: 0">Mot de Passe (confirmation)</label><div class="form-group col-sm-9"><input id="passwordConfirm" class="form-control" type="password" ng-model="client.passwordConfirm" placeholder="Mot de passe (confirmation)&#8230;" compare-to="client.password" ng-minlength="8" required=""></div></div><div class="text-center"><button id="submitRegister" class="btn btn-{{registerForm.$invalid ? \'danger\' : \'success\'}} btn-lg center-block text-center" ng-disabled="registerForm.$invalid || registerForm.$pristine" ng-click="submitRegister()">VALIDER</button></div></form></div></div></div></div>',link:function(a){'light'===a.theme&&angular.element('.izi-account').addClass('izi-light-theme')},controller:['$scope','$http','$window','$log','APIService',function(a,b,c,d,e){function f(b){(a.barcodeValid=!(!b||!e.validate.barcode(b)))?a.barcode=b:delete a.barcode}function g(){a.data=e.get.loyaltyObject(a.barcode),a.data.Offers=e.get.formattedOffers(a.data),d.info(a.data),a.hideData=!1}e.set.clientUrl(a.clientUrl),a.form={},a.QRCodeValid=!0,a.client={},b.get('scripts/directives/views/account.css').success(function(a){angular.element(document).find('head').prepend("<style type='text/css'>"+a+"</style>")}).error(function(){angular.element(document).find('head').prepend("<style type='text/css'>"+angular.element('style#izi-style').html()+"</style>"),angular.element('#izi-style').remove()}),a.customStyle?angular.element(document).find('head').prepend("<style type='text/css'>"+a.customStyle+"</style>"):0,a.getDate=function(a){return new Date(a)},a.login=function(){f(a.form.barcode),a.barcodeValid?g():c.alert("Ce n° de carte n'est pas valide !")},a.disconnect=function(){c.confirm("Êtes-vous sûr de vouloir vous déconnecter ?")?delete a.barcode:0},a.useOffer=function(a){c.confirm("Confirmez-vous l'utilisation de cette offre ?")?e.actions.useOffer(a.Id,a.Barcode):0},a.goRegister=function(){a.register=!0},a.backToLogin=function(){a.register=!1},a.submitRegister=function(){var b={Barcode:a.client.barcode,FirstName:a.client.firstname,LastName:a.client.lastname,Email:a.client.email,Phone:a.client.tel,StreetAddress:a.client.address,ZipPostalCode:a.client.zipcode,City:a.client.city,Password:a.client.password,ConfirmPassword:a.client.passwordConfirm};e.actions.register(b).then(function(){a.barcode=a.client.barcode,a.register=!1,g()})},f(a.barcode),a.barcodeValid?g():a.hideData=!0}]}}).directive('ngEnter',function(){return function(a,b,c){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(c.ngEnter)}),b.preventDefault())})}}).directive('compareTo',function(){return{require:"ngModel",scope:{otherModelValue:"=compareTo"},link:function(a,b,c,d){d.$validators.compareTo=function(b){return b===a.otherModelValue},a.$watch("otherModelValue",function(){d.$validate()})}}});