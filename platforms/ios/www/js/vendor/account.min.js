/*! izi-api (Build date: 20-05-2015) */
"use strict";angular.module('APIServiceApp').directive('iziAccount',function(){return{restrict:"EA",replace:!0,transclude:!0,scope:{barcode:"@",clientUrl:"@",theme:"@",remoteCss:"@",otherModelValue:"=compareTo",auto:"="},template:'<div><style id="izi-style">@import url(http://fonts.googleapis.com/css?family=Bevan);@import url(http://fonts.googleapis.com/css?family=Kameron:400,700);.izi-account,.izi-account form input{-ms-transition:all .3s ease-out;-o-transition:all .3s ease-out}.izi-account,.izi-account button,.izi-account h1,.izi-account h2,.izi-account h3{font-family:Bevan,Helvetica,sans-serif!important}.izi-account,.izi-account a{color:#fdfdfd!important}.md-dialog-container,md-dialog{z-index:99999!important}md-dialog,md-dialog button{position:relative!important}.izi-account{background-color:transparent!important;font-weight:400!important;max-width:600px;transition:all .3s ease-out}.izi-account,.izi-account form input{-webkit-transition:all .3s ease-out;-moz-transition:all .3s ease-out}.izi-account a,.izi-account b,.izi-account h4,.izi-account h5,.izi-account p,.izi-account small,.izi-account span{font-family:Kameron,Helvetica,sans-serif!important}.izi-account a:hover,.izi-account button.bg-accent:hover,.izi-account small{color:#fdfdfd}.izi-account h3,.izi-account h4{font-weight:500!important;color:#7ac143}.izi-account li h4{color:#fdfdfd!important}.izi-account input{font-family:Kameron,Helvetica Neue,Helvetica,sans-serif!important}.izi-account input.ng-invalid:not(.ng-pristine){border-color:#e74c3c!important}.izi-account input.ng-valid:not(.ng-pristine):not(.ng-dirty){border-color:#7ac143}.izi-account form input{color:#343434;width:75%;padding-left:2px;height:35px;margin-top:15px;margin-bottom:15px;font-size:1.5em;transition:all .3s ease-out}.izi-account form input:focus{height:45px!important;outline:0}.izi-account [name=registerForm] input{font-size:1.2em;margin:0;width:98%}.izi-account [name=registerForm] input.ng-invalid-required,.izi-account [name=registerForm] input.ng-pristine:focus{border-color:#ccc!important}.izi-account [name=registerForm] input [name=barcodeId].ng-valid:not(.ng-pristine):focus,.izi-account [name=registerForm] input.ng-valid:not(.ng-pristine):focus{border-color:#7ac143!important}.izi-account [name=registerForm] label{padding-top:8px;text-align:right;padding-left:0;margin-left:0}.izi-account .bg-rouge{background-color:#e74c3c;cursor:not-allowed}.izi-account .bg-accent{background-color:#7ac143}.izi-account .accent-color{color:#7ac143!important}.izi-account .cursor-pointer{cursor:pointer}.izi-account .no-mg-vert{margin-top:0;margin-bottom:0}.izi-account .no-radius{-webkit-border-radius:0;-moz-border-radius:0;border-radius:0}.izi-account .light{font-weight:200!important}.izi-account .barcode-container{background:#7ac143;padding:40px;width:192px;height:192px;border-radius:100%;-webkit-animation:rotateScale .6s ease-out;animation:rotate .6s ease-out}.izi-account [id=registerView]{padding-bottom:20px}.izi-account [name=barcodeId],.izi-account [name=barcodeId]:focus{border:1px solid;-webkit-border-radius:4px;-moz-border-radius:4px;border-radius:4px}.izi-account [id=submitRegister]{margin-top:12px}.izi-account .hvr-sink{cursor:pointer;vertical-align:middle;-webkit-transform:translateZ(0);transform:translateZ(0);box-shadow:0 0 1px transparent;-webkit-backface-visibility:hidden;backface-visibility:hidden;-moz-osx-font-smoothing:grayscale;-webkit-transition-duration:.3s;transition-duration:.3s;-webkit-transition-property:transform;transition-property:transform;-webkit-transition-timing-function:ease-out;transition-timing-function:ease-out}.izi-account .hvr-sink:active,.izi-account .hvr-sink:focus,.izi-account .hvr-sink:hover{-webkit-transform:translateY(8px);transform:translateY(8px)}.izi-account.izi-light-theme{background-color:transparent!important;color:#343434!important;-webkit-box-shadow:none!important;-moz-box-shadow:none!important;box-shadow:none!important}.izi-account.izi-light-theme .glyphicon,.izi-account.izi-light-theme h1,.izi-account.izi-light-theme h2,.izi-account.izi-light-theme h3,.izi-account.izi-light-theme h4,.izi-account.izi-light-theme small{color:#343434!important}.izi-account.izi-light-theme small.blanc{color:#fdfdfd}.izi-account.izi-light-theme a,.izi-account.izi-light-theme a:hover{color:#343434!important}.izi-account .izi-offers h4,.izi-account .izi-offers li,.izi-account.izi-light-theme button,.izi-account.izi-light-theme button:hover{color:#fdfdfd}.izi-account.izi-light-theme input:focus{-webkit-box-shadow:none!important;-moz-box-shadow:none!important;box-shadow:none!important}.izi-account .izi-balances li{color:#fdfdfd;padding:7px}.izi-account .izi-offers{margin-top:20px}.izi-account .izi-offers li{padding:7px}.izi-account .izi-offers li.bg-rouge{background-size:cover!important;box-shadow:inset 0 0 0 1000px rgba(231,76,60,.8)}.izi-account .izi-offers li.bg-accent{background-size:cover;box-shadow:inset 0 0 0 1000px rgba(122,193,67,.8)}.izi-account .izi-offers .izi-balances .text-center b,.izi-account .izi-offers .text-center b{font-size:1.2em}@-webkit-keyframes rotateScale{from{-webkit-transform:rotate(0);zoom:.1}to{-webkit-transform:rotate(360deg);zoom:1}}@keyframes rotateScale{from{-moz-transform:rotate(0);transform:rotate(0);zoom:.1}to{-moz-transform:rotate(360deg);transform:rotate(360deg);zoom:1}}md-dialog{width:100%!important;padding:12px 24px!important;display:block!important;margin-left:auto!important;margin-right:auto!important}md-dialog h2.md-subheader{padding-left:0}md-dialog button{display:block!important}</style><div class="izi-account center-block"><div style="padding: 15px 15px 10px" ng-if="barcode && !register"><i class="glyphicon glyphicon-remove blanc pull-right hvr-grow" style="cursor: pointer; font-size: 2.1em" ng-click="disconnect()"></i><h4 class="text-center" ng-if="data.CustomerFirstName">Prénom : {{data.CustomerFirstName}}</h4><h4 class="text-center" ng-if="data.CustomerLastName">Nom : {{data.CustomerLastName}}</h4><h4 class="text-center" ng-if="data.CustomerEmail">Email : <a class="green-sea" data-ng-href="mailto:{{data.CustomerEmail}}">{{data.CustomerEmail}}</a></h4><h3 class="text-center" ng-if="!data.CustomerFirstName && !data.CustomerLastName && !data.CustomerEmail">CARTE</h3><!-- Offers --><ul class="izi-offers list-unstyled"><li data-ng-repeat="offer in data.Offers" class="{{offer.isValid ? \'bg-accent hvr-sink\' : \'bg-rouge\'}}" ng-click="showConfirm($event, offer)" style="background: url({{offer.OfferImageUrl}}) no-repeat center -35px; margin-bottom: 15px"><b class="pull-right">x{{offer.counter === 0 ? 0 : offer.counter}}</b><h4 class="text-center no-mg-vert">{{offer.OfferClassDescription}}</h4><div class="text-center"><b>{{offer.OfferObjectDescription}}</b><br></div></li></ul><!-- Balances --><ul class="izi-balances list-unstyled"><li data-ng-repeat="balance in data.Balances" class="{{balance.Value > 0 ? \'bg-accent hvr-sink\' : \'bg-rouge\'}}" ng-click="balance.UseToPay ? showAdvanced($event, balance) : 0"><h4 class="text-center no-mg-vert">{{balance.BalanceName}}</h4><div class="text-center"><b>Solde: {{balance.Value}} {{balance.BalanceType === \'Euros\' ? \'€\' : balance.BalanceType}}</b></div></li></ul><h5 class="text-center light" ng-if="data.CustomerEmail" ng-init="bipDate = getDate(data.Barcodes[0].LastBipDate)" style="margin-bottom: 0"><small style="color: #777">Dernier passage le: {{bipDate.getDate() + \'/\' + bipDate.getMonth() + \'/\' + bipDate.getFullYear()}}</small></h5></div><!-- LOGIN VIEW --><div ng-if="!barcode && !register" style="padding: 15px 15px 5px"><h4 class="blanc text-center" style="font-weight: 700 !important">Veuillez saisir votre n° de carte pour accéder à votre compte</h4><form name="iziLoginForm"><input type="tel" class="center-block" name="barcodeId" ng-model="form.barcode" style="line-height: 24px" ng-minlength="8" maxlength="10" ng-enter="login()" ng-pattern="/^[0-9]*$/" placeholder="N° de carte&#8230;" ng-change="autoLogin()"></form><div class="clearfix"><button class="btn btn-lg center-block hvr-grow no-radius {{(iziLoginForm.barcodeId.$invalid || iziLoginForm.barcodeId.$pristine) ? \'bg-rouge\' : \'bg-accent\'}}" ng-disabled="iziLoginForm.barcodeId.$invalid || iziLoginForm.barcodeId.$pristine" ng-click="login()">Valider</button><br><a href="" class="blanc cursor-pointer pull-right" ng-click="goRegister()">S\'enregistrer</a></div></div><!-- REGISTER VIEW --><div id="registerView" ng-if="register"><i class="glyphicon glyphicon-remove blanc pull-right hvr-grow" style="cursor: pointer; margin-top: 12px;margin-right: 12px" ng-click="backToLogin()"></i><div class="container-fluid"><h3 class="blanc text-center">Enregistrer Ma Carte</h3><br><form name="registerForm" class="form-horizontal" novalidate><div class="clearfix"><label for="barcode" class="col-sm-3">N° de carte</label><div class="form-group col-sm-9"><input id="barcode" class="form-control" type="text" ng-model="client.barcode" placeholder="N° de carte&#8230;" ng-minlength="8" required=""></div></div><div class="clearfix"><label for="firstname" class="col-sm-3">Prénom</label><div class="form-group col-sm-9"><input id="firstname" class="form-control" type="text" ng-model="client.firstname" placeholder="Prénom&#8230;" ng-minlength="2" ng-pattern="/[a-zA-ZÀ-ÿ ][a-zA-ZÀ-ÿ ][a-zA-ZÀ-ÿ ]+/" required=""></div></div><div class="clearfix"><label for="lastname" class="col-sm-3">Nom</label><div class="form-group col-sm-9"><input id="lastname" class="form-control" type="text" ng-model="client.lastname" placeholder="Nom&#8230;" ng-minlength="2" ng-pattern="/[a-zA-ZÀ-ÿ ][a-zA-ZÀ-ÿ ][a-zA-ZÀ-ÿ ]+/" required=""></div></div><div class="clearfix"><label for="email" class="col-sm-3">Email</label><div class="form-group col-sm-9"><input id="email" class="form-control" type="email" ng-model="client.email" placeholder="Adresse Email&#8230;" ng-pattern="/^[_a-z0-9]+(.[_a-z0-9]+)*@[a-z0-9-]+(.[a-z0-9-]+)*(.[a-z]{2,4})$/" required=""></div></div><div class="clearfix"><label for="tel" class="col-sm-3">Tél.</label><div class="form-group col-sm-9"><input id="tel" class="form-control" type="tel" ng-model="client.tel" placeholder="N° de téléphone&#8230;" ng-pattern="/^[0-9]+$/" required=""></div></div><div class="clearfix"><label for="email" class="col-sm-3">Adresse</label><div class="form-group col-sm-9"><input id="address" class="form-control" type="text" ng-model="client.address" placeholder="Adresse&#8230;" required=""></div></div><div class="clearfix"><label for="zipcode" class="col-sm-3">Code Postal</label><div class="form-group col-sm-9"><input id="zipcode" class="form-control" type="tel" ng-model="client.zipcode" placeholder="Code Postal&#8230;" ng-minlength="5" maxlength="5" required=""></div></div><div class="clearfix"><label for="email" class="col-sm-3">Ville</label><div class="form-group col-sm-9"><input id="city" class="form-control" type="text" ng-model="client.city" placeholder="Ville&#8230;" ng-minlength="2" required=""></div></div><div class="clearfix"><label for="password" class="col-sm-3">Mot de Passe</label><div class="form-group col-sm-9"><input id="password" class="form-control" type="password" ng-model="client.password" placeholder="Mot de passe&#8230;" ng-minlength="8" required=""></div></div><div class="clearfix"><label for="password" class="col-sm-3" style="padding-top: 0">Mot de Passe (confirmation)</label><div class="form-group col-sm-9"><input id="passwordConfirm" class="form-control" type="password" ng-model="client.passwordConfirm" placeholder="Mot de passe (confirmation)&#8230;" compare-to="client.password" ng-minlength="8" required=""></div></div><div class="text-center"><button id="submitRegister" class="btn bg-{{registerForm.$invalid ? \'rouge\' : \'accent\'}} btn-lg center-block text-center no-radius" ng-disabled="registerForm.$invalid || registerForm.$pristine" ng-click="submitRegister()">VALIDER</button></div></form></div></div></div></div>',link:function(a){'light'===a.theme&&angular.element('.izi-account').addClass('izi-light-theme')},controller:['$scope','$rootScope','$element','$attrs','$http','$window','$timeout','$log','$mdDialog','APIService',function(a,b,c,d,e,f,g,h,i,j){function k(b){(a.barcodeValid=!(!b||!j.validate.barcode(b)))?a.barcode=b:delete a.barcode}function l(){a.data=j.get.emptyData(),a.data.Offers=[],j.get.loyaltyObject(a.barcode,function(b){a.data=b,a.data.Offers=j.get.formattedOffers(b),h.info(b),a.hideData=!1})}j.set.clientUrl(a.clientUrl),a.form={},a.QRCodeValid=!0,a.client={};var m;d.$observe('barcode',function(b){console.log(b),k(b),a.barcodeValid?l():0});var n=a.remoteCss?a.remoteCss:'http://localhost:8001/remotecss.css';e.get(n).success(function(a){angular.element(document).find('head').append("<style type='text/css'>"+a+"</style>"),angular.element('#izi-style').remove()}).error(function(){angular.element(document).find('head').append("<style type='text/css'>"+angular.element('#izi-style').html()+"</style>"),angular.element('#izi-style').remove()}),a.customStyle?angular.element(document).find('head').prepend("<style type='text/css'>"+a.customStyle+"</style>"):0,a.getDate=function(a){return new Date(a)},a.disconnect=function(){f.confirm("Êtes-vous sûr de vouloir vous déconnecter ?")?delete a.barcode:0},a.goRegister=function(){a.register=!0},a.backToLogin=function(){a.register=!1},a.login=function(){k(a.form.barcode),a.barcodeValid?l():f.alert("Ce n° de carte n'est pas valide !")},a.autoLogin=function(){a.auto&&(k(a.form.barcode),a.barcodeValid?l():f.alert("Ce n° de carte n'est pas valide !"))},b.useBalanceToPay=function(a){var b=j.get.emptyPassageObj();b.BalanceUpdate={Id:m.Id,UpdateValue:-parseFloat(a)},h.info('adding Passage...',JSON.stringify(b)),j.actions.addPassage(b).success(function(a){return i.hide(),h.info(a),!0})},a.useOffer=function(a){var b=j.get.emptyPassageObj();b.Offer={OfferObjectId:a.OfferObjectId,Barcode:a.Barcode||'',Date:new Date},h.info('using offer...',JSON.stringify(b)),j.actions.addPassage(b).success(function(a){return i.hide(),h.info(a),!0})},a.submitRegister=function(){var b={Barcode:a.client.barcode,FirstName:a.client.firstname,LastName:a.client.lastname,Email:a.client.email,Phone:a.client.tel,StreetAddress:a.client.address,ZipPostalCode:a.client.zipcode,City:a.client.city,Password:a.client.password,ConfirmPassword:a.client.passwordConfirm};j.actions.register(b).then(function(){a.barcode=a.client.barcode,a.register=!1,l()})},a.showConfirm=function(b,c){var d=i.confirm().title('Voulez-vous utiliser cette offre ?').content(c.OfferObjectDescription).ariaLabel('Utiliser Offre').ok('VALIDER').cancel('ANNULER').targetEvent(b);i.show(d).then(function(){a.useOffer(c)},function(){})},a.showAdvanced=function(b,c){return c.UseToPay!==!0?!1:(m=c,void i.show({clickOutsideToClose:!0,scope:a,preserveScope:!0,targetEvent:b,controller:'DialogCtrl',template:'<md-dialog aria-label="Paiement En Avoir">                                 <md-dialog-content class="sticky-container clearfix">                                     <md-subheader class="md-sticky-no-effect">PAIEMENT EN AVOIR</md-subheader>                                     <div>                                         <form action="" name="balancePaymentForm" novalidate>                                            <md-input-container>                                                 <label>Montant</label>                                                 <input ng-minlength="1" ng-pattern="/^[0-9.,]+$/" ng-model="balancePayment.value" required>                                             </md-input-container>                                         </form>                                     </div>                                     </md-dialog-content>                                     <div class="md-actions" layout="row">                                         <button class="md-primary md-button md-default-theme raised" ng-disabled="balancePaymentForm.$invalid || balancePaymentForm.$pristine" ng-click="useBalanceToPay(balancePayment.value)">                                         VALIDER                                         </button>                                         <button class="md-primary md-button md-default-theme raised" ng-click="cancel()">                                         ANNULER                                         </button>                                     </div>                                 </md-dialog>'}).then(function(){},function(){}))},k(a.barcode),a.barcodeValid?l():a.hideData=!0}]}}).directive('ngEnter',function(){return function(a,b,c){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(c.ngEnter)}),b.preventDefault())})}}).controller('DialogCtrl',['$scope','$rootScope','$mdDialog',function(a,b,c){a.hide=function(){c.hide()},a.cancel=function(){c.cancel()},a.useBalanceToPay=function(a){b.useBalanceToPay(a)}}]).directive('compareTo',function(){return{require:"ngModel",scope:{otherModelValue:"=compareTo"},link:function(a,b,c,d){d.$validators.compareTo=function(b){return b===a.otherModelValue},a.$watch("otherModelValue",function(){d.$validate()})}}});